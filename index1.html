<!DOCTYPE html>

<head>
  <meta charset="UTF-8" />
  <meta name = "viewport" content="width=device-width">
  <title>GOT</title>
  <!--script src="script.js"></script-->
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://d3js.org/d3.v4.js"></script>
  <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
  <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
  <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
  <script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
  <script src="index.js"></script>
  <link rel="stylesheet" href="index.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/gh/holtzy/D3-graph-gallery@master/LIB/d3-scale-radial.js"></script>

  
</head>

<body >

    <h2 class="text-white">Appearance graph</h2>
    <div id="my_dataviz" ></div>
    <div id="bars_characters"></div> 
</body>

<script>

    // set the dimensions and margins of the graph
    var margin = {top: 10, right: 10, bottom: 100, left: 10},
        width = 760 - margin.left - margin.right,
        height =760 - margin.top - margin.bottom,
        innerRadius = 40,
        outerRadius = Math.min(width, height) / 2;   // the outerRadius goes from the middle of the SVG area to the border
    
    // append the svg object to the body of the page
    var svg = d3.select("#my_dataviz")
      .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
      .append("g")
        .attr("transform", "translate(" + width / 2 + "," + ( height/2+100 )+ ")"); // Add 100 on Y translation, cause upper bars are longer
    
    d3.csv("/dataset/export_dataframe.csv", function(data) {
    
      
      // X scale
      var x = d3.scaleBand()
          .range([0, 2 * Math.PI])    // X axis goes from 0 to 2pi = all around the circle. If I stop at 1Pi, it will be around a half circle
          .align(0)                  // This does nothing ?
          .domain( data.map(function(d) { return d.Name; }) ); // The domain of the X axis is the list of states.
    
      // Y scale
      var y = d3.scaleRadial()
          .range([innerRadius, outerRadius])   // Domain will be define later.
          .domain([0, 100]); // Domain of Y is from 0 to the max seen in the data
    
    
 

    var myColor = d3.scaleRadial()
            //.domain(data.map(function(d) { return d.House; }))
      .domain(["Lannister", "Targaryen", "Stark", "Clegane", "Free Folk","Bolton","Greyjoy","Kingsguard","R'hllor","Baratheon","Night's Watch","Tyrell","Martell","Faceless Men","Dothraki","Frey","Brotherhood Without Banners","Tarly","Arryn","Baelish","Good Masters","Varys"])
      .range(["#C61616", "#A000C6", "#F4F4F4","#00EAB8","#FFFFFF", "#FFAEAE", "#474747","#600C0C","#FFD597","#F4D71B","#000000", "#2B9A2B", "#EF8F2F","#FF1DBE","#A25D0A", "#B9B9B9","#8aa263","#185818","#1E91E7","#92DC92","#0A208E","#D3A7FF"])

      // Add bars
      svg.append("g")
        .selectAll("path")
        .data(data)
        .enter()
        .append("path")
          .attr("fill", "#69b3a2")
          //.attr("fill", (function (d) { return myColor(d.House); }) )
          .attr("d", d3.arc()     // imagine your doing a part of a donut plot 
              .innerRadius(innerRadius)
              .outerRadius(function(d) { return y(d['Value']); })
              .startAngle(function(d) { return x(d.Name); })
              .endAngle(function(d) { return x(d.Name) + x.bandwidth(); })
              .padAngle(0.01)
              .padRadius(innerRadius))
              
              
        

        // Add the labels (will be visible on mouseover only)
        /*
        var popupDiv = d3
          .select("#my_dataviz")
          .append("div")
          .attr("class", "tooltip")
          .style("opacity", 0);

          svg.append("#my_dataviz") // Change this to your element(s)
            .on("mouseenter", function (d, i) {
                popupDiv.transition().duration(200).style("opacity", 0.3);
                popupDiv
                  .html(i.Name) // Example of display a data item description
                  .style("left", d.x + "px") // X offset can be added here
                  .style("top", d.y + "px"); // Y offset can be added here
              })
            .on("mouseout", function (d, i) {
                  popupDiv.transition().duration(200).style("opacity", 0);
              })
        */
        
        svg.append("g")
            .selectAll("g")
            .data(data)
            .enter()
            .append("g")
                .attr("text-anchor", function(d) { return (x(d.Name) + x.bandwidth() / 2 + Math.PI) % (2 * Math.PI) < Math.PI ? "end" : "start"; })
                .attr("transform", function(d) { return "rotate(" + ((x(d.Name) + x.bandwidth() / 2) * 180 / Math.PI - 90) + ")"+"translate(" + (y(d['Value'])+10) + ",0)"; })
            //.append("text")
                

            .on('mouseover', function(d, i) {
                // Select the title, use .text to set the content
                // d is the data point
                d3.append("text");
                // Leave the highlight part alone
                // d3.select(this) is the circle on the page
                d3.select(this.Name)
                  .transition()
                  .duration(100)
                  .attr('r', 20)
                  .attr('fill', '#ff0000');
              })

              .on('mouseout', function(d, i) {
                  // return the mouseover'd element
                  // to being smaller and black
                  d3.select(this.Name)
                    .transition()
                    .duration(100)
                    .attr('r', 10)
                    .attr('fill', '#000000');
                })






                .text(function(d){return(d.Name)})
                .attr("transform", function(d) { return (x(d.Name) + x.bandwidth() / 2 + Math.PI) % (2 * Math.PI) < Math.PI ? "rotate(180)" : "rotate(0)"; })
                //.on("mouseover", function(d){               
                  //svg.select(this.parentNode).select('.text').style("visibility", "visible")})
                .style("font-size", "8px")
                .style("fill", "white")
                .attr("alignment-baseline", "middle")
                //.on("mouseenter", handleMouseOver)
                //.on("mouseout", handleMouseOut);
                    
    
    })

 
   
/*
// set the dimensions and margins of the graph
var margin = {top: 200, right: 20, bottom: 30, left: 50},
    width = 500 - margin.left - margin.right,
    height = 420 - margin.top - margin.bottom;

// append the svg object to the body of the page
var svg = d3.select("#bars_characters")
  .append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform",
          "translate(" + margin.left + "," + margin.top + ")");

//Read the data

  d3.csv("/dataset/characters_appearances.csv", function(data) {
  // Add X axis
  var x = d3.scaleLinear()
    .domain([0, 73])
    .range([ 0, width ]);
  svg.append("g")
    .attr("transform", "translate(0," + height + ")")
    .call(d3.axisBottom(x));

  // Add Y axis
  var y = d3.scaleLinear()
    .domain([0, 73])
    .range([ height, 0]);
  svg.append("g")
    .call(d3.axisLeft(y));

  // Add a scale for bubble size
  var z = d3.scaleLinear()
    .domain([200000, 1310000000])
    .range([ 1, 40]);

  // Add dots
  svg.append('g')
    .selectAll("dot")
    .data(data)
    .enter()
    .append("circle")
      .attr("cx", function (d) { return x(d.episode_1); } )
      .attr("cy", function (d) { return y(d.name); } )
      .attr("r", function (d) { return z(d.pop); } )
      .style("fill", "#69b3a2")
      .style("opacity", "0.7")
      .attr("stroke", "black")

})
*/

   var rateById = d3.map();
var quantize = d3.scale.quantize()
    .domain([1, 1000]) 
    .range(d3.range(9).map(function(i) { return "q" + i + "-9"; }));
var projection = d3.geo.albersUsa()
    .scale(3960) 
    .translate([width / 2, height / 2]);
var path = d3.geo.path()
    .projection(projection);
var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);
queue()
    .defer(d3.csv, "/dataset/characters_appearances.csv")
    .defer(d3.tsv, "Example.tsv", function(d) {
    if (d.episode_1 > 0 && d.episode_2 > 0) d.color = "saddlebrown"; 
    else if (d.episode_1 > 0) d.color = "green"; 
    else if (d.episode_2 > 0) d.color = "mediumpurple";
    else d.color = "lightgrey";
    rateById.set(d.id, d.color);
})
    .await(ready);
function ready(error, us) {
  if (error) throw error;
  svg.append("g")
      .attr("class", "counties")
    .selectAll("path")
      .data(topojson.feature(us, us.objects.counties).features)
    .enter().append("path")
    .attr("class", function(d) { return quantize(rateById.get(d.id)); })
    .attr("d", path);
  svg.append("path")
      .datum(topojson.mesh(us, us.objects.states, function(a, b) { return a !== b; }))
      .attr("class", "states")
      .attr("d", path);
}
d3.select(self.frameElement).style("height", height + "px");

</script>
    
